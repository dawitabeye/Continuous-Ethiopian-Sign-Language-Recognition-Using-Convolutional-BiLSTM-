Proxmox Virtualization and Backup Setup
=======================================

Overview
--------
This setup describes a data center configuration using Proxmox VE (PVE) for running production workloads 
and Proxmox Backup Server (PBS) for managing secure, incremental backups. ZFS is used on both PVE and PBS 
for redundancy and performance using RAIDZ. Backups are organized under a dedicated namespace and are 
synchronized to an offsite location for disaster recovery.

Setup Components
----------------

1. Proxmox VE (PVE)
   - Role: Primary virtualization host
   - Purpose: Hosts critical applications and services using VMs and containers

2. Proxmox Backup Server (PBS)
   - Role: Backup server for PVE
   - Purpose: Stores backups with deduplication, compression, and optional encryption
   - Sync: Sends backups to an offsite PBS or remote storage for disaster recovery

3. ZFS Configuration
--------------------

On Proxmox VE (PVE)
--------------------
- Create a ZFS pool for storing VMs:
  zpool create main-pve01-vm raidz /dev/sdX /dev/sdY /dev/sdZ
  - Pool Name: main-pve01-vm
  - Use Case: Fast, redundant storage for VM disks

On Proxmox Backup Server (PBS)
-------------------------------
- Create a ZFS pool for backup storage:
  zpool create zfs-pool-01 raidz /dev/sdX /dev/sdY /dev/sdZ

- Create a Datastore on the ZFS pool:
  - Name: main-pbs01-backup
  - Mount point: /mnt/datastore/main-pbs01-backup

- Enable ZFS compression (recommended):
  zfs set compression=zstd zfs-pool-01

- Create a namespace under the datastore:
  proxmox-backup-manager datastore namespace create main-pbs01-backup-ns --datastore main-pbs01-backup

4. Adding PBS Storage to PVE
----------------------------
To connect the PBS datastore to PVE:

From the PVE Web GUI:
- Navigate to: Datacenter > Storage > Add > Proxmox Backup Server

Fill in the following fields:

- ID: main-pbs01-backup-ns
- Server: <PBS-IP-ADDRESS> or hostname
- Username: root@pam
- Password: Your PBS root password
- Datastore: main-pbs01-backup
- Namespace: main-pbs01-backup-ns
- Fingerprint:
  - Copy from PBS Web Dashboard > Access > TLS Certificate > SHA-256 Fingerprint

Click Add to finalize the connection. Backups from PVE can now be targeted directly to the PBS namespace.

Backup Workflow
---------------
1. PVE is scheduled to back up VMs and containers.
2. Backups are sent to PBS and stored in the datastore main-pbs01-backup, under the namespace main-pbs01-backup-ns.
3. Backups are incremental, deduplicated, and compressed using ZFS.
4. PBS is configured to sync backup data to an offsite PBS or remote storage periodically.

Benefits
--------
- High-performance VM hosting with local ZFS storage on PVE
- Reliable and space-efficient backups with PBS using deduplication and compression
- Data redundancy using RAIDZ on both PVE and PBS sides
- Clear separation and control using backup namespaces
- Enhanced security using TLS fingerprint verification during PBS storage setup
- Offsite synchronization for disaster recovery assurance

Summary
-------
This complete architecture provides a robust, scalable solution using open-source tools — Proxmox VE and Proxmox Backup Server — 
combined with ZFS storage and namespace isolation. The setup supports production virtualization, efficient backups, 
and secure offsite replication for data protection and recovery readiness.| Main Function     | Run VMs and containers         | Backup and restore data             |
| Type              | Hypervisor / Virtualization    | Backup Solution                     |
| GUI               | Yes                            | Yes                                 |
| Backup Support    | Basic (vzdump)                 | Advanced (incremental, encrypted)   |
| Storage Options   | ZFS, LVM, Ceph, etc.           | Local, remote, encrypted            |
| Integration       | Works with PBS                 | Designed to back up PVE             |

Key Difference:
---------------
- **PVE** is for running workloads (VMs/containers).
- **PBS** is for protecting those workloads through backups.

They are **designed to work together** for a full virtualization and backup infrastructure.









Proxmox Virtualization and Backup Setup
=======================================

Overview
--------
This setup describes a data center configuration using Proxmox VE (PVE) for running production workloads 
and Proxmox Backup Server (PBS) for managing secure backups. ZFS is used on the PBS side with RAIDZ 
and compression enabled for efficient storage and redundancy. A namespace is created within the 
datastore to organize backups. Backup data is also synchronized to an offsite location for disaster recovery.

Setup Components
----------------

1. Proxmox VE (PVE)
   - Role: Primary virtualization host
   - Purpose: Runs critical applications and services as VMs or containers
   - Backups: Configured to send regular backups to PBS

2. Proxmox Backup Server (PBS)
   - Role: Backup management server
   - Purpose: Receives, stores, and manages backups from PVE
   - Storage: Configured with a ZFS pool using RAIDZ and compression
   - Sync: Backup data is synchronized to an offsite PBS or remote storage for disaster recovery

3. ZFS Configuration on PBS
   - RAID Level: RAIDZ (for redundancy and performance)
   - Compression: Enabled (e.g., lz4 or zstd) to reduce disk usage
   - ZFS Pool: Created and mounted
     - Example command:
       ```
       zpool create zfs-pool-01 raidz /dev/sdX /dev/sdY /dev/sdZ
       ```
   - Datastore: Created from the ZFS pool
     - Example name: `pbs-datastore`

4. Namespace Creation
   - Purpose: Organize backup data under logical grouping (e.g., node, environment)
   - Namespace Name: `main-pbs01-backup-ns`
   - Command:
     ```
     proxmox-backup-manager datastore namespace create main-pbs01-backup-ns --datastore pbs-datastore
     ```

Backup Workflow
---------------
1. PVE is configured to perform scheduled backups of VMs and containers.
2. These backups are sent to PBS and stored in the datastore `pbs-datastore` under the namespace `main-pbs01-backup-ns`.
3. The backups are incremental, deduplicated, and compressed using ZFS.
4. PBS is configured to sync the stored backups to an offsite PBS or remote storage at scheduled intervals.
5. This setup ensures local data protection as well as disaster recovery readiness through offsite replication.

Benefits
--------
- Efficient and secure virtualization platform using PVE
- Reliable and space-optimized backups using PBS with ZFS
- Data redundancy through RAIDZ
- Namespace improves backup organization and access control
- Offsite backup sync protects against local disasters

Summary
-------
This Proxmox infrastructure setup provides an enterprise-grade open-source solution for virtualization 
and backup. It leverages PVE and PBS, integrated with ZFS storage and logical namespace structuring 
for scalable and secure backup management.
